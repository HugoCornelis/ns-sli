<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.7: http://docutils.sourceforge.net/" />
<title>README file for simplecell-M</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 6253 2010-03-02 00:24:53Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: left }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="readme-file-for-simplecell-m">
<h1 class="title">README file for simplecell-M</h1>

<div class="section" id="introduction">
<h1>Introduction</h1>
<p>This model implements the solution to an exercise in the
GENESIS Modeling Tutorial section &quot;Building a cell the easy way&quot;
(<a class="reference external" href="http://www.genesis-sim.org/GENESIS/UGTD/Tutorials/genprog/simplecell-tut.html">http://www.genesis-sim.org/GENESIS/UGTD/Tutorials/genprog/simplecell-tut.html</a>)</p>
<p>The exercise suggests adding a muscarinic current to the 'simplecell'
model, by using the function 'make_KM_bsg_yka' that is defined in the
prototypes library <tt class="docutils literal">neurokit/prototypes/yamadachan.g</tt>.</p>
<p>Instead of using 'setupalpha' or 'setuptau', this function uses a for loop
to fill the A and B tables with tau and minf values, then calls 'tweaktau
KM_bsg_yka X' to convert them to proper A and B values.  The original
tables have 50 entries, spanning a range -0.1 to 0.1 Volts, rather than the
usual -0.1 to 0.05 Volts.  The function then uses TABFILL to expand it to
3001 entries, using a B-spline fit under GENESIS 2.</p>
<p>The file yamadachan.g also contains a function for creating a transient
pottassium &quot;A current&quot; conductance that uses the 'setuptau' command.
This was not tested in this simulation.</p>
<p>The default simulation runs for 0.5 sec with a 0.5 nA current injection to
/cell/soma, producing the output file 'simplecell-M_Vm.out'.</p>
</div>
<div class="section" id="summary-of-results">
<h1>Summary of results</h1>
<p>The plotted results for the default simulation described above show that
the non-hsolved GENESIS 2 results have significant deviations from the G-3
sli_run results, with a 6 msec difference in position of the last spike.
The GENESIS 2 version with hsolve chanmode 3 causes errors due to a GENESIS
2 hsolve restriction that requires all gate tables to have the same size.
Neither 'sli_load' nor 'sli_run' give any errors associated with the
'tweaktau' command.</p>
<p>When 'ndf_load' and 'run' are used to run the saved NDF file, there is a
single initial peak and no further firing.  Further studies in the
'simplecells/' collection indicated that ndf_load is not properly
processing the values of <tt class="docutils literal">HH_TABLE_START</tt> and <tt class="docutils literal">HH_TABLE_END</tt> in
the NDF file.</p>
</div>
<div class="section" id="files">
<h1>Files</h1>
<p>Main simulation scripts:</p>
<pre class="literal-block">
simplecell-M-g3.g - this adds a Muscarinic current KM_bsg_yka from
  yamadachan.g - output is to &quot;simplecell-M_Vm.out&quot;
simplecell-M-g2.g - GENESIS 2 version with graphics, run from control panel
simplecell-M-h3-g2.g - GENESIS 2 version using hsolve in chanmode 3
</pre>
<p>Accessory scripts:</p>
<pre class="literal-block">
cell-M.p - the cell parameter file for the simplecell-M model

graphics.g - the standard graphical interface for the GENESIS 2 scripts
protodefs-M.g - creates library of protoype channels and cell components
    for simplecell-M-g3.g using hh_tchan.g and yamadachan.g.
</pre>
<p>Sample output:</p>
<pre class="literal-block">
simplecell-M.ndf - NDF file created from simplecell-M-g3.g with sli_load
    and ndf_save

simplecell-M-g2_Vm.out - output from GENESIS 2 for simplecell-M-g3.g
simplecell-M-sli_run_Vm.out - output from gshell sli_run
simplecell-M-ndf_load_Vm.out - output using 'ndf_load' plus 'run'
</pre>
</div>
<div class="section" id="testing-procedure-and-results">
<h1>Testing Procedure and Results</h1>
<p>To run under GENESIS 2:</p>
<pre class="literal-block">
$ genesis simplecell-M-g3.g
... usual startup messages
Simulation Script:  simplecell-M-g3.g
/library
/
changing clock [0] from 1 to 2e-05
reading 'cell-M.p'....
cell-M.p read: 2 compartments, 5 channels, 0 shells, 2 others
time = 0.000000 ; step = 0
time = 0.500000 ; step = 25000
completed 25000 steps in 0.092986 cpu seconds
genesis #0 &gt; quit
$ mv simplecell-M_Vm.out simplecell-M-g2_Vm.out
</pre>
<p>In principle, one would then use GENESIS 2 to run simplecell-M-h3-g2.g from
the GUI.  Click on 'RESET', 'RUN', and 'QUIT'.  However, this revealed
some problems with GENESIS 2 hsolve, producing the error:</p>
<pre class="literal-block">
** Error -  during SETUP of /cell/solver: all tables must have same size.
hsolve invdx=15000.000000 is != ip invd=20000.000000
</pre>
<p>A variation on this script, described below, provides a workaround.</p>
<p>To run under gshell with sli_run:</p>
<pre class="literal-block">
$ genesis-g3
Welcome to the GENESIS 3 shell
genesis &gt; sli_run simplecell-M-g3.g
... some startup messages - No error msgs
Simulation Script:  simplecell-M-g3.g
/library
/
changing clock [0] from 1 to 2e-05
reading 'cell-M.p'....
cell-M.p read: 2 compartments
time = 0.000000 ; step = 0
time = 0.500000 ; step = 25000
completed 25000 steps in 0.022996 cpu seconds
genesis &gt; quit
$ mv simplecell-M_Vm.out simplecell-M-sli_run_Vm.out
</pre>
<p>To test the results:</p>
<pre class="literal-block">
$ plotVm simplecell-M-sli_run_Vm.out simplecell-M-g2_Vm.out
</pre>
<p>There is a 6 msec difference in position of the last spike from the
non-hsolved GENESIS 2 version,</p>
<p>To save as NDF:</p>
<pre class="literal-block">
genesis &gt; sli_load simplecell-M-g3.g
... some startup messages - No error msgs
Simulation Script:  simplecell-M-g3.g
/library
/
changing clock [0] from 1 to 2e-05
reading 'cell-M.p'....
cell-M.p read: 2 compartments
genesis &gt; ndf_save /cell/** simplecell-M.ndf
genesis &gt; quit
</pre>
<p>To load and run:</p>
<pre class="literal-block">
$ genesis-g3
Welcome to the GENESIS 3 shell
genesis &gt; ndf_load simplecell-M.ndf
genesis &gt; runtime_parameter_add /cell/soma INJECT 0.5e-9
genesis &gt; output_add /cell/soma Vm
genesis &gt; output_filename simplecell-M-ndf_load_Vm.out
genesis &gt; run /cell 0.5
genesis &gt; quit
</pre>
<p>To test the results:</p>
<pre class="literal-block">
$ plotVm simplecell-M-sli_run_Vm.out simplecell-M-ndf_load_Vm.out simplecell-M-g2_Vm.out
</pre>
<p>The version loaded from simplecell-M.ndf fires a single initial spike
and then remains polarized at about -65.5 mV.  Zooming in on the first
action potential reveals that the ndf_load results agree with the other
two until about 4.3 msec, on the falling slope of the action potential
at about -30 mV.  An examination of the plot for non-solved GENESIS 2,
shows that there are &quot;dips&quot; in the membrane potential as it starts to
rise towards threshold, and then decreases again.  At this point the
G2 and sli_run results diverge.  This voltage of about -62.5 mV is
evidently one in which the depolarizing and hyperpolarizing currents
are nearly balanced, and small numerical inaccuracies can become amplified.
The divergence of the ndf_load result so early is a mystery.  The
activation time constant for the muscarinic current varies between 50 and
250 msec, and it is unlikely to be strongly activated so early.</p>
<p>Note that unlike the RScell simulation, which uses 'setupalpha' to
implement a different model of muscarinic current, this simulation uses the
'tweaktau' command.  This produces no error messages.  The table for
GATE_KINETIC &quot;A_18_18&quot; in the ndf file 'simplecell-M.ndf' looks correct
when compared with the results of commands such as <tt class="docutils literal">showfield KM_bsg_yka
*</tt> or <tt class="docutils literal">showfield KM_bsg_yka <span class="pre">X_A-&gt;table[562]</span></tt> under GENESIS 2.
However, the tables in the NDF representation contain 3000 points instead
of 3001, and have slightly less precision than the results displayed with
'showfield' in GENESIS 2.</p>
</div>
<div class="section" id="additional-scripts-for-debugging">
<h1>Additional scripts for debugging</h1>
<p>The muscarinic current defined by the function make_KM_bsg_yka in
yamadachan.g has three differences from a typical script that directly
creates the gate table with 'setupalpha'.</p>
<ul class="simple">
<li>the gate tables are created and filles with only 50 values,
and then expanded to 3001 (xdivs = 3000) points with TABFILL</li>
<li>the range (xmin and xmax) is set to -0.1 to 0.1 V, rather than the default
-0.1 to 0.05 V</li>
<li>initially they are filled with tau and minf values, and the 'teaktau'
command is used to convert them to A and B values, before the TABFILL
operation</li>
</ul>
<p>These additional scripts were developed to aid debugging of the
scripts above with variations to narrow down the source of the problem:</p>
<p><em>simplecell-M_no_tweak-g3.g</em> - a variation of simplecell-M-g3.g that
avoids the use of 'tweaktau' by calculating the A and B table
values from tau and minf, and filling the tables directly.
It also uses voltage values xmin and xmax of -0.1 to 0.05, rather
than range of -0.1 to 0.1 used in yamadachan.g.</p>
<p><em>Mchan.g</em> - implements the function make_KM_bsg_yka_no_tweak, which
is substituted for yamadachan.g function make_KM_bsg_yka in
protodefs-M_no_tweak.g</p>
<p><em>protodefs-M_no_tweak.g</em> - creates prototypes for simplecell-M_no_tweak-g3.g</p>
<p><em>simplecell-M_no_tweak-h3-g2.g</em> - similar to simplecell-M-h3-g2.g, but
includes protodefs-M_no_tweak.g.  It works properly with hsolve chanmode 3.</p>
<p>When simplecell-M_no_tweak-g3.g is used with sli_load/ndf_save and
ndf_load/run, it generates results similar, but not identical, to
simplecell-M-sli_run_Vm.out instead of firing a single spike.
The results may be compared with:</p>
<pre class="literal-block">
$ plotVm simplecell-M_no_tweak-h3_Vm.out \
simplecell-M_no_tweak-sli_run_Vm.out \
simplecell-M_no_tweak-ndf_load_Vm.out
</pre>
<p>With extreme zoom, the sli_run and ndf_load + run versions can be seen to
be not exactly the same, but nearly indistinguishable. The initial peaks
agree well, but by the last AP, the G2 hsolved version peak is delayed from
the G3 results by 1.2 msec.  This is satisfactory agreement, considering
the &quot;amplification effect&quot; that slow K currents can have on small numerical
differences.</p>
<p>Note that the original range of  -0.1 to 0.1 V spread over 49 divisions
means that each table entry is separated by about 4 mV.  Even with
interpolation to the larger table, this may be too coarse of a sampling
for this current.  By restricting the range to -0.1 to 0.05 V, each
of the initial 49 divisions corresponds to only 3 mV.  This may yield
slightly different results.</p>
<p>Another variation of Mchan.g and these scripts explored the effect
of using 100 rather than only 50 entries in the original unexpanded
table.  Running under GENESIS 2, it showed some differences in location
of the final action potentials.  This suggests that the manner in which
the table are filled and expanded may significantly affect the results.</p>
<p>In order to see if the non-standard range option or the 'tweaktau' command
was responsible for the failure of ndf_load to yield correct results,
another set of scripts was developed in 'simplecells' that found 'tweaktau'
to be working properly, and that the NDF file properly records the
table values and the range information.  However, ndf_load is not properly
processing the values of <tt class="docutils literal">HH_TABLE_START</tt> and <tt class="docutils literal">HH_TABLE_END</tt> in
the NDF file.</p>
</div>
</div>
</body>
</html>
